SELECT B.REQUISITION_NO REQUISITION_NO,
       COALESCE(C.inquiry_no,D.inquiry_no) INQUIRY_NO,
       A.ORDER_NO ORDER_NO,
       A.SUB_CON_NO SUB_CON_NO,
       'A' BLOCO
FROM IFSCTR.PURCHASE_ORDER A
LEFT JOIN IFSCTR.PURCHASE_REQ_LINE_PART B ON B.ORDER_NO = A.ORDER_NO
LEFT JOIN IFSCTR.QUOTATION_LINE_PART_ORD_CON C ON C.order_no = A.ORDER_NO
LEFT JOIN IFSCTR.INQUIRY_LINE_PART_ORDER D ON D.requisition_no = B.REQUISITION_NO
--WHERE B.REQUISITION_NO IS NOT NULL
GROUP BY B.REQUISITION_NO, C.inquiry_no, A.REQUISITION_NO, A.ORDER_NO, A.SUB_CON_NO, D.inquiry_no

UNION ALL

SELECT E.REQUISITION_NO REQUISITION_NO,
       NULL INQUIRY_NO,
       A.ORDER_NO ORDER_NO,
       NULL SUB_CON_NO,
       'B' BLOCO
FROM IFSCTR.PURCHASE_REQUISITION E
LEFT JOIN IFSCTR.PURCHASE_ORDER A ON A.ORDER_NO = IFSCTR.PURCHASE_REQ_LINE_PART_API.Get_Order_No(E.requisition_no,1,1)
WHERE E.REQUISITION_NO NOT IN (
    SELECT B.REQUISITION_NO
    FROM IFSCTR.PURCHASE_ORDER A
    LEFT JOIN IFSCTR.PURCHASE_REQ_LINE_PART B ON B.ORDER_NO = A.ORDER_NO
    WHERE B.REQUISITION_NO IS NOT NULL)
        
    
    UNION ALL
    
SELECT NULL REQUISITION_NO,
       NULL INQUIRY_NO,
       NULL ORDER_NO,
       F.SUB_CON_NO SUB_CON_NO,
       'C' BLOCO
FROM IFSCTR.SUB_CONTRACT F
WHERE F.SUB_CON_NO NOT IN (
SELECT A.SUB_CON_NO
FROM IFSCTR.PURCHASE_ORDER A
LEFT JOIN IFSCTR.PURCHASE_REQ_LINE_PART B ON B.ORDER_NO = A.ORDER_NO
LEFT JOIN IFSCTR.QUOTATION_LINE_PART_ORD_CON C ON C.order_no = A.ORDER_NO
LEFT JOIN IFSCTR.INQUIRY_LINE_PART_ORDER D ON D.requisition_no = B.REQUISITION_NO
