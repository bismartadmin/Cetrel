--Impedir a liberação da requisição de compra se a flag Notas estiver desmarcada e os codigos de compra sejam iguais a SSI, SSU,SMI, SMU, SSE, SME.
DECLARE

rowkey_ varchar2(4000) := '&NEW:ROWKEY';
purchase_code_ varchar2(4000) := '&NEW:PURCHASE_CODE';
justificativa_ varchar2(4000) := NULL;

BEGIN
  
SELECT 'S'
INTO justificativa_
FROM PURCHASE_REQ_LINE_PART_CFT PRLP
WHERE PRLP.ROWKEY = rowkey_
AND PRLP.CF$_JUSTIFICATIVA IS NOT NULL;
EXCEPTION WHEN NO_DATA_FOUND THEN justificativa_ := 'N';

  IF purchase_code_ IN ('RSE','RSDC','RSFU','RME','RMDC','RMFU')
    AND justificativa_ = 'N' THEN
    RAISE_APPLICATION_ERROR(-20100,'CTR_SUP_001: Em requisições de emergência/dispensa de cotação/fornecedor único, o preenchimento da justificativa é obrigatório.');
   END IF;
END;
