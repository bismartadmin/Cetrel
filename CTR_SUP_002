--Tornar o último fornecedor comprado em fornecedor principal
DECLARE

attr_ VARCHAR2(3200);
last_supplier_ VARCHAR2(3200);

BEGIN

SELECT VENDOR_NO
INTO last_supplier_
FROM PURCHASE_ORDER_LINE_PART
WHERE OBJSTATE = 'Closed'
AND PART_NO = '&NEW:PART_NO'
ORDER BY LAST_ACTIVITY_DATE DESC
FETCH FIRST ROW ONLY;

Client_Sys.Add_To_Attr('SUPPLIER_LAST_BUYED',last_supplier_,attr_);
Client_Sys.Add_To_Attr('CONTRACT','&NEW:CONTRACT',attr_);
Client_Sys.Add_To_Attr('PART_NO','&NEW:PART_NO',attr_);
Client_Sys.Add_To_Attr('ROWKEY','&NEW:ROWKEY',attr_);

transaction_SYS.Deferred_Call('CTR_SUP_002', attr_,'CTR_SUP_002: Inserir último fornecedor de compra do material');

EXCEPTION
WHEN NO_DATA_FOUND THEN
Dbms_Output.Put_Line('');
END;
